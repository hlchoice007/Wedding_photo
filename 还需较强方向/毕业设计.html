<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>







<script type="text/javascript">















#include<reg52.h>      头文件
#include <intrins.h>   头文件
#define  uchar  unsigned  char 
#define  uint   unsigned  int

#include "eeprom52.h"
uchar code  ArrDig[]={ 0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
uchar num=0;
uchar shu=0; 
uchar ge=9;

sbit K1 = P3^2; 
sbit K2 = P3^3; 
sbit K3 = P3^4;  
sbit Buzzer= P2^0; 
sbit Buzzer1= P2^1; 
bit flag=1;

void delay(uint num)
{
	while(num--) ;
}

void write_eeprom()
{
	SectorErase(0x2000);
	byte_write(0x2000, ge);
  	byte_write(0x2060, a_a);	
}
void read_eeprom()
{
	ge   = byte_read(0x2000);
 	a_a      = byte_read(0x2060);
}
void init_eeprom()
{
	read_eeprom();		
	if(a_a != 5)		
	{
		ge = 9;
    a_a = 5;
		write_eeprom();
	}	
}

void key()  
{    
	if(!K1)
	{  
		delay(20);
		if(!K1)
		{   
			while(!K1);
            shu=0; 
			num=0;
        }
	}
		 
    if(!K2)
	{  
		delay(20);
		if(!K2)
		{   
			while(!K2);
            ge+=1;
			if(ge>9) { ge=9; } 
			P0=ArrDig[ge];
            write_eeprom();      
        }
	}
	if(!K3)
	{  
		delay(20);
		if(!K3)
		{   
			while(!K3);
            ge-=1;
			if(ge<1) { ge=1; } 
			P0=ArrDig[ge];
            write_eeprom();     	
        }
	}

}

void Time0_Init()  
{
	TMOD= 0x01;	
	TH0 = 0xEC;
  	TL0 = 0x78;
	IE  = 0x82;	
	TR0 = 1;		
}
										
void  main()
{	
  Time0_Init();
  init_eeprom();      		
  P0=ArrDig[ge];
		
	while(1)
	{
	   key();
	}	 
}
 
void Time0_Int() interrupt 1
{
	TH0 = 0xEC;
  	TL0 = 0x78;	 //5ms
	num++;
	if(num>=100) //500
	{
   		num=0;
		shu++;
		if(shu/2>=ge && shu/2<(ge+10)){ flag=0; }
		if(shu/2>(ge+10)){ flag=1;  Buzzer=1; Buzzer1=0;}
		if(flag==0) {  Buzzer=~Buzzer; Buzzer1=~Buzzer1;}
  	}
}



















</script>

















</body>
</html>

